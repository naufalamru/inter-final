(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();const g="modulepreload",w=function(r){return"/inter-final/"+r},f={},p=function(t,o,s){let e=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));e=Promise.allSettled(o.map(l=>{if(l=w(l),l in f)return;f[l]=!0;const d=l.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":g,d||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),d)return new Promise((b,m)=>{u.addEventListener("load",b),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return e.then(i=>{for(const a of i||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})};async function y(r){const t="=".repeat((4-r.length%4)%4),o=(r+t).replace(/-/g,"+").replace(/_/g,"/"),s=atob(o),e=new Uint8Array(s.length);for(let n=0;n<s.length;++n)e[n]=s.charCodeAt(n);return e}async function k(r){try{const o=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:await y(r)});return console.log("Push subscribed",o),await fetch(window.STORY_API_BASE+"/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:window.AUTH_TOKEN},body:JSON.stringify(o)}).catch(s=>console.warn("subscription send failed",s)),o}catch(t){throw console.error("Failed to subscribe",t),t}}async function v(){try{const t=await(await navigator.serviceWorker.ready).pushManager.getSubscription();t&&(await fetch(window.STORY_API_BASE+"/subscriptions/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:window.AUTH_TOKEN},body:JSON.stringify({endpoint:t.endpoint})}).catch(()=>{}),await t.unsubscribe(),console.log("Push unsubscribed"))}catch(r){console.error("Failed to unsubscribe",r)}}async function S(){try{return!!await(await navigator.serviceWorker.ready).pushManager.getSubscription()}catch{return!1}}const P="storymap-db",E=2;let c;function A(){const r=indexedDB.open(P,E);r.onupgradeneeded=t=>{c=t.target.result,c.objectStoreNames.contains("stories")||c.createObjectStore("stories",{keyPath:"id"}),c.objectStoreNames.contains("pending")||c.createObjectStore("pending",{autoIncrement:!0}),c.objectStoreNames.contains("bookmarks")||c.createObjectStore("bookmarks",{keyPath:"id"})},r.onsuccess=t=>{c=t.target.result,console.log("IDB ready")},r.onerror=t=>{console.error("IDB error",t)}}async function _(r,t){if(!navigator.onLine)return;const o=[],s=c.transaction("pending","readonly").objectStore("pending").openCursor();s.onsuccess=async e=>{const n=e.target.result;if(n)o.push({key:n.key,val:n.value}),n.continue();else for(const i of o)try{const a=new FormData;for(const d in i.val)a.append(d,i.val[d]);await fetch(r+"/stories",{method:"POST",headers:{Authorization:t},body:a}),c.transaction("pending","readwrite").objectStore("pending").delete(i.key)}catch(a){console.warn("sync failed",a)}}}function T(r){return new Promise((t,o)=>{const s=c.transaction("bookmarks","readwrite");s.objectStore("bookmarks").put(r).onsuccess=()=>t(!0),s.onerror=e=>o(e)})}function C(r){return new Promise((t,o)=>{const s=c.transaction("bookmarks","readwrite");s.objectStore("bookmarks").delete(r).onsuccess=()=>t(!0),s.onerror=e=>o(e)})}function B(r){return new Promise((t,o)=>{const e=c.transaction("bookmarks","readonly").objectStore("bookmarks").get(r);e.onsuccess=()=>t(!!e.result),e.onerror=n=>o(n)})}function I(){return new Promise((r,t)=>{const o=[],s=c.transaction("bookmarks","readonly").objectStore("bookmarks").openCursor();s.onsuccess=e=>{const n=e.target.result;n?(o.push(n.value),n.continue()):r(o)},s.onerror=e=>t(e)})}const O="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk";function L(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/inter-final/sw.js").then(e=>{console.log("SW registered",e)}).catch(e=>console.warn("SW registration failed",e));let r;window.addEventListener("beforeinstallprompt",s=>{s.preventDefault(),r=s;const e=document.createElement("button");e.id="install-app-button",e.textContent="Install App",e.style.marginLeft="8px",document.querySelector("header").appendChild(e),e.addEventListener("click",async()=>{e.disabled=!0,r.prompt();const n=await r.userChoice;console.log("Install choice",n),e.remove()})});const t=document.createElement("button");t.id="push-toggle",t.textContent="Enable Push",t.setAttribute("aria-pressed","false"),t.style.marginLeft="8px",t.addEventListener("click",async()=>{if(!("serviceWorker"in navigator)||!("PushManager"in window)){alert("Push notifications are not supported in this browser.");return}await S()?(await v(),t.textContent="Enable Push",t.setAttribute("aria-pressed","false")):(await k(O),t.textContent="Disable Push",t.setAttribute("aria-pressed","true"))});const o=document.querySelector("header");o&&o.appendChild(t),A(),window.addEventListener("online",()=>{_(window.STORY_API_BASE,window.AUTH_TOKEN)})}window.STORY_API_BASE="https://story-api.dicoding.dev/v1";window.addEventListener("DOMContentLoaded",()=>{const r=localStorage.getItem("token"),t=location.hash;!r&&!t.startsWith("#/login")&&!t.startsWith("#/register")&&(location.hash="#/login"),r&&(t.startsWith("#/login")||t.startsWith("#/register"))&&(location.hash="#/"),window.AUTH_TOKEN=r||null,p(async()=>{const{default:o}=await import("./router-l5mEuGpk.js");return{default:o}},[]).then(({default:o})=>{p(async()=>{const{default:s}=await import("./appController-DqZtN_Wq.js");return{default:s}},[]).then(({default:s})=>{const e=document.getElementById("app"),n=new s(e);o(e,n)})})});window.addEventListener("keydown",r=>{r.key.toLowerCase()==="m"&&!r.metaKey&&!r.ctrlKey&&(location.hash="#/map")});window.addEventListener("load",()=>{try{L()}catch(r){console.warn("PWA init failed",r)}});export{T as b,I as g,B as i,C as u};
