const c=typeof STUDENT<"u"&&STUDENT.STORY_API_BASE?STUDENT.STORY_API_BASE:window.STORY_API_BASE||"https://story-api.dicoding.dev/v1";class h{async fetchStories(){try{const o=await fetch(`${c}/stories`,{headers:{Authorization:window.AUTH_TOKEN||""}});if(!o.ok)throw new Error("Gagal mengambil data story");const t=await o.json();return t.listStory||t.stories||[]}catch(o){return console.error(o),[]}}async postStory(o){try{const t=await fetch(`${c}/stories`,{method:"POST",headers:{Authorization:window.AUTH_TOKEN||""},body:o});if(!t.ok)throw new Error("Gagal menambahkan story");return await t.json()}catch(t){throw console.error(t),t}}}const l=typeof STUDENT<"u"&&STUDENT.STORY_API_BASE?STUDENT.STORY_API_BASE:window.STORY_API_BASE||"https://story-api.dicoding.dev/v1";class d{async register({name:o,email:t,password:n}){const r=`${l}/register`;console.log("Register URL:",r),console.log("Register payload:",{name:o,email:t,password:n});try{const e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,email:t,password:n})});console.log("Response status:",e.status);const a=await e.text();console.log("Raw response text:",a);let s;try{s=JSON.parse(a)}catch{s={message:a}}if(!e.ok)throw console.error("Register failed with:",s),new Error(s.message||"Gagal registrasi");return console.log("Register success:",s),s}catch(e){throw console.error("Register error:",e),e}}async login({email:o,password:t}){const n=`${l}/login`;try{const r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:t})}),e=await r.json();if(!r.ok)throw new Error(e.message||"Gagal login");return window.AUTH_TOKEN=`Bearer ${e.loginResult.token}`,e.loginResult.token}catch(r){throw console.error("Login error:",r),r}}}class w{constructor(o){this.root=o,this.storyModel=new h,this.authModel=new d}async loadStories(){return await this.storyModel.fetchStories()}async addStory(o){return await this.storyModel.postStory(o)}async register(o){return await this.authModel.register(o)}async login(o){const t=await this.authModel.login(o);window.AUTH_TOKEN=`Bearer ${t}`,localStorage.setItem("token",`Bearer ${t}`),location.hash="#/"}logout(){localStorage.removeItem("token"),window.AUTH_TOKEN="",location.hash="#/login"}render(o){this.root.innerHTML="",this.root.appendChild(o.render())}}export{w as default};
